Header
                                                              화면
 화면ID purFeeRtMng화면명e매입요율관리                                       P4-4  작성자  이준호
                                                              패턴

 화면
 정의   창고 매니저가 매입요율을 조회/등록/수정/삭제 하는 화면이다.



 Title  매입요율관리



         [*C]작업장     [C]작업장찾기   계약협력사      [C]협력사명찾기  매입항목       [C]항목명 찾기

 Search:매입사용여부검색                 적용일자 2010/01/01 ~ 2010/12/31                검색
                                              달력          달력



        요율목록

         순번  작업장   계약협력사     매입항목        매입부서     매입아이템유형    매입아이템     매입아이템 명


          1  성북센터   성지물류  매입항목명   팝업   매입부서명 팝업            아이템코드  팝업  아이템명

 EList:매입요율목록성북센터   성지물류  매입항목명   팝업   매입부서명 팝업            아이템코드  팝업  아이템명


         C   매입단위분류   매입단위    사용여부    자동여부          비고

                                             비고

                                             비고


                                                                          행추가 행삭제


















                                         1
       요율상세목록


        라인번호   확정여부      적용시작일자       적용종료일자       적용단가     통화코드    기준작업물량

        00001           2010/01달력1   2010/01달력1

        00002           2010/01달력1   2010/01달력1
EList:매출요율상세리스트

       C  적용시작물량   적용종료물량            비고


                             비고

                             비고



                                                                         행추가 행삭제


Button                                                                     저장































                                       2
          이벤트명                                              이벤트 설명

                        [in]로그인id, 법인코드
                        [callEvent]
          OPEN
                        [doc] 조회조건의 적용일자 From 값은 당해년도 1월 1일 (예-2010/01/01), To 값은 Sysdate 값을 셋팅한다.
                        사용여부의 값은 default로 ‘Y’ Setting 함.

                        [url] 공통.작업장선택팝업
                        [in]법인코드,사용자사번
                        [out] 작업장코드, 작업장명
         작업장선택
                        [doc]조회조건을 만족하는 작업장이 1건인 경우 바로 작업장코드, 작업장명을 setting 한다.
                        조회건수가 없거나, 여러건의 경우 팝업창을 띄우고, 검색한 결과를 선택하면 부모창으로 작업장코드, 작업장명을 넘기고
                        팝업창을 닫는다.

                        [url] 공통.고객거래처(거래처구분그룹-협력사)선택 팝업
                        [in]거래처코드 또는 거래처명
       계약협력사선택          [out] 거래처코드, 거래처명
                        [doc]1건의 거래처코드인 경우, 조회된 거래처(거래처구분그룹-협력사) 정보 중 선택된 거래처명을 부모 창으로 전달 후 화면을

                        닫는다. 여러건의 경우 팝업창을 띄우고, 팝업내에서 선택된 거래처, 거래처명을 부모 창으로 전달 후 화면을 닫는다.
event
                        [url] 공통.매출입항목선택 팝업
                        [in]매입항목코드,매입항목명,사용여부(Y로 setting),법인코드
                        [out] 매입항목코드, 매입항목명
        매입항목선택          [doc]조회조건을 만족하는 매입항목이 1건인 경우 바로 매입항목코드, 매입항목명을 setting 한다.
                        조회건수가 없거나, 여러건이 경우 팝업창을 띄우고, 검색한 결과를 선택하면 부모창으로 매입항목코드, 매입항목명을 넘기고

                        팝업창을 닫는다.
                        [trigger]Click
          달력선택
                        [doc] 날짜를 선택할 수 있도록 달력 컴포넌트를 보여준다.





















                                                     3
          이벤트명                                               이벤트 설명

                        [trigger] click
                        [in] 매입요율목록검색조건

       매입요율목록검색         [out] 매입요율목록,
                        [doc] 매입요율목록검색조건을 input parameter로 보관정산요율 table(TB_WM06001),에서 매입요율목록을 검색한다.
                        (매입요율목록검색조건 중 적용일자 From 과 To 는 매입요율상세목록의 검색조건임. 따라서 보관정산요율상세 table

                         TB_WM06002을 Join하여 적용시작일자 와 적용종료일자 의 검색조건값으로 input 함. 맨 마지막장 SQL 참조 요망)

                        [trigger] click
                        [in] 매입요율

     매입요율상세목록검색         [out]매입요율상세목록
                        [doc] 매입요율목록에서 한 Row를 선택하면, 매입요율을 input 값으로 보관요율상세 table(TB_WM06002)에서 매입요율상세목록을

                         읽어온다.(select key는 창고정산요율번호 맨 마지막장 SQL 참조 요망)

                        [trigger] click
                        [doc] 신규 매입요율을입력할 수 있는 행을 맨 아래에 추가한다.

event                   -. 작업장과 계약협력사는 조회조건의 값을 default로 setting 한다.(등록전 검색이 먼저 선행 되어야 함)
        요율목록행추가         -. 행추가 버튼 클릭시 이미 이전에 행추가하여 입력하고 있는 Data가 있으면 ‘현재 입력중인 Data를 저장하시기 바랍니다’

                         메시지를 Display한다.
                        -. 매입항목, 매입부서, 매입아이템유형 매입단위분류, 매입단위, 사용여부, 자동여부는 필수 입력 항목 임.
                         매출입구분코드는 ‘20’ setting.



                        [trigger] click
      요율상세목록행추가         [doc] 신규 매입요율상세를 입력할 수 있는 행을 맨 아래에 추가한다.

                        -. 확정여부, 적용시작일자, 적용종료일자 적용단가, 통화코드는 필수 입력 항목 임.



                        [trigger] click
                        [in] 매입요율, 매입요율상세목록
                        [out] 매입요율저장 성공, 실패여부

           저장           [doc] 매입요율, 매입요율상세를 등록 또는 수정처리 한다.
                        -. 신규 등록시 요율목록만 등록하고 요율상세목록을 등록하지 않은 상태에서 저장은 불가하다. ‘요율상세를 등록하시기 바랍니다’

                         메시지를 Display한다.
                        -. 저장시 창고정산요율번호는 Varchar2(10) type이며, SQ_TB_WM06001_FEE_RT_NO에서 sequence를 받아와서 생성한다
                        -. 창고정산요율상세의 창고정산요율라인번호는 생성되는 순서대로 sequence하게 채번하여 Varchar2(5) type으로 생성한다.






                                                     4
               [화면 display]

               -. 특이사항 없음.
               1)요율목록

               [매입아이템유형]
               -. 기타코드(분류코드-69)로 매출아이템유형 Display
               [매입아이템] [매입아이템명]

               -. 아이템코드 또는 아이템명 을 조회 조건으로 팝업 Open.
               [매입단위분류]

               -. 기타코드(분류코드-20)로 기본단위분류코드명 Display
               [매입단위]
               - 매입단위분류코드에 맞는 단위코드명을 Display한다. (기타코드리스트 참조)
     화면 제어
               [사용여부]
               -. 기타코드(분류코드-06)로 사용여부명 Display

               [자동여부]
               -. 기타코드(분류코드-06)로 사용여부명 Display
               2)요율상세목록

               [확정여부]
document       -. 기타코드(분류코드-06)로 사용여부명 Display

               [적용시작일자] [적용종료일자]
               -. 적용종료일자는 적용시작일자보다 빠를 수 없다.
               [통화코드]

               -. 기타코드(분류코드-27)로 화폐코드 Display

               -.신규등록시 매입요율과 매입요율상세목록을 다 입력해야만 저장이 가능하다.

     업무 규칙     -.요율수정시 요율목록은 매입아이템유형, 매입아이템, 매입단위분류, 매입단위, 사용여부, 비고 만 수정가능하다.
                요율상세목록은 전체칼럼 수정가능하다.

               -.조회조건에 조회하고자 하는 매입요율의 조건 값을 입력하고 검색버튼을 클릭한다.

     이벤트 흐름    -.매입요율목록이 Display되면 상세조회 하고자 하는 매입요율목록을 Click한다.
               -.Detail 창에 매입요율상세목록이 Display된다.
     (순서 정의)
               - 수정하고자 하는 경우 매입요율목록 과 매입요율상세목록 항목을 수정하고 저장 버튼을 클릭한다.
               -.신규등록의 경우 매입요율목록과 매입요율상세목록에서 행추가 버튼을 클릭후 신규내역을 입력하고 저장 버튼을 클릭한다.










                                                5
         select *
          from tb_wm06001 a,
             tb_wm06002 b
         where a.wrhs_exca_fee_rt_no = b.wrhs_exca_fee_rt_no
           and a.corp_cd = '법인코드'

           and a.work_pl_cd = '작업장코드'
           and a.sell_buy_sctn_cd = ‘20' --매입
           and a.sell_buy_attr_cd = '매입항목코드'
           and a.use_yn = '사용여부'
           and ('적용시작일자' between b.aply_strt_ymd and b.aply_end_ymd OR
              '적용종료일자' between b.aply_strt_ymd and b.aply_end_ymd)


         select *
          from tb_wm06002 a
         where a.wrhs_exca_fee_rt_no = '창고정산요율번호'
           and ('적용시작일자' between a.aply_strt_ymd and a.aply_end_ymd OR
              '적용종료일자' between a.aply_strt_ymd and a.aply_end_ymd)


document





























                                                                          6