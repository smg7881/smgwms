# 공통코드 화면 마이그레이션 작업 정리

작성일: 2026-02-16  
대상: `D:\project\soybean\src\views\system\code\index.vue` -> `smgWms system/code`

## 1. 작업 개요
- Soybean Vue 공통코드 화면(마스터/상세 2패널 구조)을 Rails + Hotwire + Stimulus 구조로 이식.
- 메뉴 위치는 요청사항에 맞춰 `system/code`로 구성.
- 구현 전 PRD를 작성한 후, PRD 기준으로 소스를 생성.

## 2. PRD 생성
- 생성 파일: `doc/공통코드/PRD_공통코드_마이그레이션.md`
- 포함 내용:
  - 범위/비범위
  - 데이터 모델
  - 라우팅/API 계약
  - 화면/Stimulus 이벤트 규약
  - 수용 기준(Acceptance Criteria)

## 3. 생성/수정한 소스
### 3.1 라우팅
- 수정: `config/routes.rb`
- 추가 경로:
  - `GET/POST/PATCH/DELETE /system/code`
  - `GET/POST/PATCH/DELETE /system/code/:code_id/details/:detail_code`

### 3.2 DB 마이그레이션
- 생성: `db/migrate/20260216090000_create_adm_code_tables.rb`
  - `adm_code_headers`
  - `adm_code_details`
  - 인덱스/유니크 키 포함
- 생성: `db/migrate/20260216090100_add_system_code_menu.rb`
  - `SYS_CODE` 메뉴 등록 (`/system/code`)

### 3.3 모델
- 생성: `app/models/adm_code_header.rb`
- 생성: `app/models/adm_code_detail.rb`
- 적용 내용:
  - 유효성 검증
  - 정규화(normalize)
  - 감사 필드(create/update by/time) 자동 세팅
  - 관계(마스터-상세) 정의

### 3.4 컨트롤러
- 생성: `app/controllers/system/code_controller.rb`
  - 마스터 목록(HTML/JSON), 등록/수정/삭제
  - 검색 조건: `code`, `code_name`, `detail_code`, `detail_code_name`, `use_yn`
- 생성: `app/controllers/system/code_details_controller.rb`
  - 상세 목록(JSON), 등록/수정/삭제

### 3.5 ViewComponent / View
- 생성: `app/components/system/code/page_component.rb`
- 생성: `app/components/system/code/page_component.html.erb`
- 생성: `app/views/system/code/index.html.erb`
- 구성:
  - 상단 검색 폼
  - 하단 마스터/상세 2패널 AgGrid
  - 마스터/상세 각각 모달 CRUD

### 3.6 Stimulus 컨트롤러
- 생성: `app/javascript/controllers/code_header_crud_controller.js`
- 생성: `app/javascript/controllers/code_detail_crud_controller.js`
- 수정: `app/javascript/controllers/index.js`
  - `code-header-crud`, `code-detail-crud` 등록

### 3.7 AG Grid Renderer
- 수정: `app/javascript/controllers/ag_grid/renderers.js`
- 추가:
  - `codeUseYnCellRenderer`
  - `codeHeaderActionCellRenderer`
  - `codeDetailActionCellRenderer`

### 3.8 스타일
- 수정: `app/assets/stylesheets/application.css`
- 추가:
  - 공통코드 2패널 레이아웃/타이틀/선택코드 표시 스타일
  - 반응형 1열 전환 미디어쿼리

## 4. 원본 Vue 대비 반영 포인트
- 반영:
  - 마스터/상세 분할 구조
  - 검색 필드 구조
  - 선택 마스터 기준 상세 조회
- 차이점:
  - Vue의 배치저장(셀 inline 편집 기반)은 미적용
  - 우리 시스템 표준(모달 CRUD + BaseCrud + ResourceForm) 방식으로 통일

## 5. 참고한 규약/문서
- `doc/frontend/STIMULUS_COMPONENTS_GUIDE.md`
- 기존 화면 패턴:
  - `system/dept`
  - `system/menus`
  - `system/users`

## 6. 현재 상태 및 확인 필요
- PRD 작성 완료
- 소스 생성 완료
- 아직 실행 검증(마이그레이션/화면 동작/테스트)은 미진행
- 작업 중 워크트리에 기존 변경사항(타 작업 파일)이 함께 존재해 별도 검증 분리 필요

## 7. 다음 권장 검증 절차
1. `bin/rails db:migrate`
2. `bin/rails routes | findstr system/code`
3. `/system/code` 화면 접속 후 마스터/상세 CRUD 수동 점검
4. `bin/rails test` 및 필요 시 system test 추가
