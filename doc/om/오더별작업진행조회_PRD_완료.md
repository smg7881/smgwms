# 오더별작업진행조회 PRD

## 1. 개요
선택한 오더(오더번호 기준)에 대한 상세 오더 정보, 아이템별 진행 실적, 그리고 관련 작업별(출고/운송/입고 등) 진행 상세 내역을 한 화면에서 조회하는 기능입니다.

## 2. User Flow (화면 간의 유기적인 흐름)
1. **오더 검색**: 사용자가 상단 조회조건에서 `오더번호`를 입력(직접 입력 또는 팝업)하고 검색 버튼을 클릭합니다.
2. **오더 기본 정보 조회**: 검색된 오더 1건에 대한 상세 마스터 정보가 화면 상단 폼(Form)에 출력됩니다.
3. **오더 아이템 및 진행 상세 조회**: 
   * **오더아이템 그리드**: 해당 오더에 속한 아이템 목록과 아이템별 수량/중량/부피(오더 vs 실적)가 표출됩니다.
   * **오더작업진행상세 그리드**: 해당 오더의 차량정보, 출발지/도착지, 출발예정일시, 각 단계별 트래킹(출고, 운송, 입고, 출발, 도착) 상태가 표출됩니다.
4. **상세 팝업 연결**: 특정 아이템 라인을 선택 후 `작업단계상세정보` 버튼(또는 더블클릭)을 눌러 하위 상세 팝업을 띄울 수 있도록 설계 준비 여지를 남깁니다. (현재는 단일 화면 관점에서 구성)

## 3. UI Component List (Rails 8 & Stimulus 기반)
* **Page Layout**: `Om::BasePageComponent` 상속 레이아웃.
* **서치폼 영역 (오더번호 검색)**: `resource_form`을 활용.
    * 조회 필드: 오더번호 (팝업 제공, `search-popup` 컨트롤러 활용)
    * `search-form` Stimulus Controller 연동.
* **마스터 영역 (오더 정보 폼)**: 
    * 폼 형태의 ReadOnly 텍스트 컴포넌트들. 검색 결과를 바인딩해서 보여주는 영역. 
    * 항목: 고객오더번호, 오더번호, 고객오더유형, 오더요청고객, 계약번호 등.
* **그리드 영역 (2개의 분할된 레이아웃 또는 상하 배치)**:
    * **오더아이템 그리드 (ag-grid)**: 아이템별 오더 내역과 실적 내역을 컬럼 그룹화하여 나란히 표기 (`children` 컬럼 그룹핑 기능 활용).
    * **오더작업진행상세 그리드 (ag-grid)**: 차량번호, 동선, 각 단계별 체크/상태 정보 표현.
* **프론트엔드 액션 제어**: `om_order_work_progress_controller.js`
    * 검색 성공 이벤트 발생 시, 전달받은 JSON 데이터에서 Master 폼 데이터 할당, Item 그리드 데이터 바인딩, Progress 그리드 데이터 바인딩 3가지를 동시 수행.

## 4. Data Mapping (화면 입력 필드와 매칭되는 DB 메타데이터)
> **대상 테이블 (예상):** 오더(`TB_OM03001`), 오더아이템(`TB_OM03002`), 실적(`TB_OM05002`), 운송배차(`TB_OM04005` 등).

### 4.1. 서치 & 마스터 폼
| 화면 항목명 | 영문/속성명 | 속성 | 비고 (매핑 정보) |
|---|---|---|---|
| 예약/오더번호 | ordNo | E | 조회 조건 (M) |
| 고객오더번호 | custOrdNo | R | `TB_OM03001` |
| 고객오더유형 | custOrdTypeNm | R | `TB_CM02006` (공통) 조회 |
| 오더유형 | ordTypeNm | R | 오더유형명 |
| 오더상태 | ordStatNm | R | 상태명 |
| 관련 고객사 | ctrtCustNm 등 | R | 거래처명 (`TB_CM04001`) |

### 4.2. 오더아이템 (Grid 1)
| 화면 항목명 | 영문/속성명 | 비고 (매핑 및 표시 방식) |
|---|---|---|
| 분배 차수 | divDgrCnt | |
| 아이템 코드/명 | itemCd / itemNm | `TB_CM03001` 아이템 마스터 조인 |
| 작업상태 | workStat | 실적 상태 매핑 |
| 단위(기본) | basisCd | 단위 |
| 오더 실적 (그룹) | | **오더** (qty, wgt, vol) / **실적** (qty, wgt, vol) 으로 컬럼 헤더 2단 분리 |

### 4.3. 오더작업진행상세 (Grid 2)
| 화면 항목명 | 영문/속성명 | 비고 |
|---|---|---|
| 차량번호 | carNo | `TB_OM04005` |
| 출발/도착지 | dptArNm, arvArNm | 작업장/거래처 마스터 매핑 |
| 예상/실제 일시 | dptPrarDate 등 | 도착, 출발 관련 날짜 컬럼 네가지 |
| 상태 (그룹/열) | gi, tran, gr, dpt, arv | 출고, 운송, 입고, 출발, 도착 현황 (아이콘/텍스트) |

## 5. Logic Definition (비즈니스 로직)
1. **마스터 조회**: 오더번호 1건을 기반으로 `OmOrder` 단건 데이터를 찾고, 연결된 공통코드 및 고객사 명칭을 치환하여 응답합니다.
2. **디테일 조회 1 (아이템 집계)**: 오더번호 기준으로 `OmOrderItem`을 조회하고, Left Outer Join 으로 실적테이블(`OmWorkResultItem` 등)의 합산된 실적수량을 매핑해와 대비(오더 수량 vs 실적 수량)하여 표출합니다.
3. **디테일 조회 2 (진행 단계 상세 지표)**: 오더번호와 연관된 배차 지시(운송오더 로그) 내역을 찾고, 상태코드 컬럼들을 Pivoting 혹은 단순 매핑하여 각 구간별(출고완료, 도착완료 등) 시간/상태값을 그리드에 보여줍니다.

## 6. 화면 정의 (System Layout)
* **상단 조건바**: 오더번호 조회 필드 및 `검색` 버튼.
* **중앙 상단 (Master)**: 오더 기본 및 고객 정보 ReadOnly Form (3~4 Row X 4 Column Grid).
* **중앙/하단 (Details)**: 탭 방식 또는 상하 50:50 분할 배치로 두 개의 AG Grid 제공.
    * Grid 1: 오더 아이템 실적 비교.
    * Grid 2: 오더 작업 구간별 상태.
