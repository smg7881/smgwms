# PRD: 결재이력관리 (Approval History Management)

## 1. User Flow (화면 흐름)

사용자가 시스템에 접속하여 결재 이력을 조회하고, 상세 내용을 확인하거나 승인/반려 처리를 수행하는 흐름입니다.

1.  **화면 진입 (Initial Load)**
    *   사용자가 '결재이력관리' 메뉴에 접근합니다.
    *   시스템은 로그인한 사용자의 정보를 바탕으로 **법인**과 **요청자/결재자** 정보를 자동으로 설정합니다.
    *   초기 화면은 '결재 진행 중(요청 중)'인 건만 필터링되어 조회됩니다.

2.  **조건 검색 (Search)**
    *   사용자가 조회 조건(법인, 결재상태, 요청자, 결재자)을 변경합니다.
    *   검색 조건 입력 시, 돋보기 버튼을 클릭하여 **법인선택 팝업**이나 **사용자선택 팝업**을 통해 정확한 코드를 입력할 수 있습니다.
    *   [검색] 버튼을 클릭하면 전체 조건에 맞는 결재 이력 목록이 그리드에 표시됩니다.

3.  **상세 확인 및 결재 처리 (Detail & Action)**
    *   조회된 목록에서 특정 항목을 클릭합니다.
    *   **결재요청승인 팝업**이 실행됩니다.
        *   로그인 ID가 **요청자**인 경우: 결재 요청 관리 화면이 표시됩니다.
        *   로그인 ID가 **승인자**인 경우: 결재 승인 관리 화면이 표시됩니다.

---

## 2. UI Component List (UI 구성요소)

화면은 크게 **조회 조건 영역(Search Area)**과 **결재 이력 목록 영역(List Area)**으로 구성됩니다.

### 2.1 조회 조건 영역 (Search Area)
| 구분 | 라벨(Label) | 타입(Type) | 설명/속성 | 비고 |
| :--- | :--- | :--- | :--- | :--- |
| **Input** | 법인 (Corporation) | Text + Button | 법인코드 및 법인명 입력. 검색 팝업 버튼 포함. | **필수(Mandatory)** |
| **Combo** | 결재상태 (Status) | Dropdown | 결재 진행 상태 선택 (전체/요청/승인 등). | 초기값: '전체' 세팅되나 로직상 '요청중' 조회 |
| **Input** | 요청자 (Requestor) | Text + Button | 요청자 코드 및 성명 입력. 검색 팝업 버튼 포함. | **필수(Mandatory)** |
| **Input** | 결재자 (Approver) | Text + Button | 결재자 코드 및 성명 입력. 검색 팝업 버튼 포함. | **필수(Mandatory)** |
| **Button** | 검색 (Search) | Button | 조회 실행 트리거. | |

### 2.2 결재 이력 목록 영역 (List Area)
| 구분 | 컬럼명 (Header) | 타입 (Type) |
| :--- | :--- | :--- |
| **Grid** | No | Sequence |
| **Grid** | 메뉴명 (Menu Name) | Text |
| **Grid** | 결재요청순번 (Req Sequence) | Text |
| **Grid** | 결재요청일자 (Req Date) | Date (YYYY-MM-DD) |
| **Grid** | 결재요청자 (Requestor) | Text |
| **Grid** | 결재상태 (Status) | Text |
| **Grid** | 담당결재자 (Charge Approver) | Text |
| **Grid** | 결재승인일자 (Approval Date) | Date (YYYY-MM-DD) |
| **Grid** | 결재요청내용 (Req Contents) | Text |

---

## 3. Data Mapping (데이터 매핑)

화면 UI 항목과 내부 데이터 속성(영문명) 간의 매핑 정보입니다.

### 3.1 조회 조건 (Search Condition)
*   **법인:** `corpCd` (코드), `corpNm` (명)
*   **결재상태:** `apvStat` (Status)
*   **요청자:** `reqrCd` (요청자 구분), `userCd` (사용자코드)
*   **결재자:** `apverCd` (결재자 구분), `userCd` (사용자코드)

### 3.2 목록 데이터 (List Data)
*   **메뉴명:** `menuNm`
*   **결재요청순번:** `apvReqSeq`
*   **결재요청일자:** `apvReqYmd`
*   **결재요청자:** `apvReqr`
*   **결재상태코드:** `apvStatCd`
*   **담당결재자:** `chrgApver`
*   **결재승인일자:** `apvApvYmd`
*   **결재요청내용:** `apvReqConts`
*   **결재의견:** `apvOpi`

---

## 4. Logic Definition (로직 정의)

### 4.1 초기화 로직 (Initialization - Open Event)
1.  **콤보박스 설정:** 기타코드 28번(결재유형) 정보를 가져와 '결재상태' 콤보를 구성하며, 기본값은 "전체"로 설정합니다.
2.  **사용자 자동 세팅:** 로그인한 사용자의 ID를 사용하여 **결재자**와 **요청자** 필드에 OR 조건으로 자동 세팅합니다.
    *   *예외:* 시스템 관리자는 이 필드를 임의로 변경할 수 있습니다.
3.  **초기 조회 규칙:** 화면 오픈 시 데이터가 존재할 경우, 기본적으로 **'결재 요청 중'인 건만 필터링**하여 조회합니다.
4.  **기본값:** 등록일시/수정일시는 DB `sysdate`, 등록자/수정자는 현재 로그인 사용자로 처리합니다.

### 4.2 조회 로직 (Search Logic)
1.  **재조회 규칙:** 최초 오픈 시에는 '요청 중'인 건만 조회되지만, 이후 사용자가 조회 조건을 변경하여 재조회할 경우 전체 상태에 대한 조회가 가능해야 합니다.
2.  **이벤트 흐름:** 조회 조건 입력 -> 조회 버튼 클릭 -> `RetrieveApvHistListCmd` 실행 -> 그리드 데이터 바인딩.

### 4.3 팝업 연동 로직 (Popup Logic)
1.  **법인 선택 (`CorpSlcPopup.jsp`):**
    *   입력된 법인코드/명으로 조회.
    *   **Auto-Select:** 조회 결과가 1건일 경우, 팝업을 띄우지 않고 즉시 화면에 값을 세팅합니다.
2.  **사용자 선택 (`UserSlcPopup.jsp`):**
    *   요청자 및 결재자 검색 시 사용.
    *   **Auto-Select:** 조회 결과가 1건일 경우, 팝업 없이 사용자코드/명을 즉시 세팅합니다.

### 4.4 상세 이동 로직 (Grid Click Logic)
1.  **트리거:** 그리드의 결재 이력 항목 클릭 시 발생.
2.  **결재 팝업 호출:**
    *   **Input 파라미터:** 로그인ID, 법인, 메뉴코드, 결재번호 등.
    *   **화면 분기:** 로그인한 사용자가 해당 건의 '요청자'이면 **결재요청** 화면을, '승인자'이면 **결재승인** 화면을 띄워야 합니다.
