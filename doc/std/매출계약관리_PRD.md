# PRD: 매출계약관리 (Sales Contract Management)

## 1. User Flow (사용자 흐름)

사용자가 매출계약 정보를 조회, 등록, 수정, 삭제하는 전체적인 흐름은 다음과 같습니다.

1.  **화면 진입 (Initial Load):**
    *   화면이 열리면(Open), 법인, 거래처, 계약구분 등 초기화에 필요한 공통코드 데이터(산업군, 부가세구분, 결재방법 등)를 로드합니다.
    *   조회기간은 시스템 날짜(sysdate)를 기준으로 기본 설정됩니다.

2.  **계약 검색 (Search):**
    *   사용자는 검색 조건(법인, 거래처, 계약구분, 계약번호, 조회기간)을 입력합니다.
    *   '조회' 버튼을 클릭하면 조건에 맞는 매출계약 목록이 그리드(Grid)에 표시됩니다.

3.  **상세 정보 조회 (View Details):**
    *   목록에서 특정 매출계약을 선택(Click)합니다.
    *   하단 탭 영역(기본정보, 추가정보, 오더유형, 품명, 영업사원, 고객, 정산, 변경이력)에 상세 정보가 바인딩됩니다.

4.  **신규 계약 등록 (Create):**
    *   '행추가' 버튼을 클릭하여 목록에 신규 레코드를 생성합니다.
    *   필수 항목(거래처, 부서, 계약기간, 금액 등)을 입력합니다. 거래처 선택 시 사업자번호, 부가세구분 등 기본 정보가 자동 채워집니다.
    *   각 탭(Tab) 별로 필요한 세부 정보를 입력합니다(예: 품명, 영업사원).

5.  **정보 수정 및 저장 (Update & Save):**
    *   기존 계약 정보를 수정하거나 신규 입력한 정보를 확인합니다.
    *   '저장' 버튼을 클릭하면 유효성 검사(Validation) 후 DB에 저장됩니다. 수정 시 변경 이력 테이블(`TB_CM05011`)에 이전 데이터가 기록됩니다.

6.  **계약 삭제 (Logical Delete):**
    *   데이터를 물리적으로 삭제하지 않고, '사용여부'를 '아니오(No)'로 변경하여 논리적으로 삭제 처리합니다.

---

## 2. UI Component 리스트

화면은 크게 **검색 영역**, **목록 영역(Master)**, **상세 영역(Detail - Tabs)**으로 구성됩니다.

### 2.1 검색 영역 (Search Area)
| UI 요소 | 타입 | 설명 | 비고 |
| :--- | :--- | :--- | :--- |
| 법인 (Corporation) | Popup/Input | 법인코드 및 법인명 | 필수 |
| 거래처 (BusinessAcq) | Popup/Input | 거래처코드 및 거래처명 | `10` 고객 그룹만 조회 |
| 계약구분 (ContractSection) | Select Box | 계약 형태 구분 (전체/매출 등) | 기본값: 전체 |
| 계약번호 (ContractNumber) | Input | 검색할 계약번호 직접 입력 | |
| 조회기간 (InquiryPeriod) | DatePicker | 검색 시작일 ~ 종료일 | Start <= End 체크 |

### 2.2 매출계약 목록 (Master Grid)
| 컬럼명 | 설명 | 데이터 매핑 |
| :--- | :--- | :--- |
| 거래처번호 | 거래처 식별 코드 | `bzacNo` |
| 거래처명 | 거래처 명칭 | `bzacNm` |
| 매출계약번호 | 계약 고유 번호 | `sellCtrtNo` |
| 매출계약명 | 계약 명칭 | `sellCtrtNm` |
| 사업자번호 | 사업자 등록 번호 | `bizmanNo` |
| 계약기간 | 시작일 ~ 종료일 | `ctrtStrtYmd`, `ctrtEndYmd` |
| 사용여부 | 사용 가능 여부 (Y/N) | `useYn` |

### 2.3 상세 정보 탭 (Detail Tabs)
하단 영역은 8개의 탭으로 구성되어 있습니다.

1.  **매출계약기본정보:** 계약번호, 거래처, 부서, 각종 일자(오더접수, 계약시작/종료), 금액, 결재조건 등 핵심 정보.
2.  **매출계약추가정보:** 계약금액변경사유, 책임조항, 재계약/해지조건, 이익률 등 관리 정보.
3.  **매출계약오더유형정보:** 오더유형코드, 기본작업경로, 작업단계 등록.
4.  **매출계약품명정보:** 고객아이템코드, 품명, 화종, 규격 정보.
5.  **매출계약영업사원정보:** 영업담당자, 부서, 기여도(%), 대표여부.
6.  **매출계약고객정보:** 고객 담당자 상세 연락처(전화, 이메일 등).
7.  **매출계약정산정보:** 은행코드, 계좌번호, 예금주, 화폐, 환율 기준.
8.  **매출계약변경이력정보:** 변경된 컬럼, 변경 전/후 내용, 수정자 정보 (Read Only).

---

## 3. Data Mapping

주요 UI 항목과 DB 컬럼 간의 매핑 정보입니다.

| 영역 | 한글명 | 영문명 (Column ID) | 속성 | 필수여부 |
| :--- | :--- | :--- | :--- | :--- |
| **Search** | 법인코드 | `corpCd` | Editable | **M** |
| | 거래처코드 | `bzacCd` | Editable | Optional |
| **Basic Info** | 매출계약번호 | `sellCtrtNoCd` | Editable | **M** |
| | 매출계약명 | `sellCtrtNmCd` | Editable | **M** |
| | 사업자번호 | `bizmanNo` | Editable | **M** |
| | 계약부서코드 | `ctrtDeptCd` | Editable | **M** |
| | 계약시작일 | `ctrtStrtDay` | Editable | **M** |
| | 계약종료일 | `ctrtEndDay` | Editable | **M** |
| | 계약금액 | `ctrtAmtCd` | Editable | **M** |
| | 부가세구분 | `vatSctnCd` | Editable | **M** |
| **Sales Rep** | 영업담당자 | `salesOfcrCd` | Editable | **M** |
| | 기여도(%) | `contributeRate` (유추) | Editable | **M** |
| **Settlement** | 은행코드 | `bankCd` | Editable | **M** |
| | 예금주명 | `dpstrNmCd` | Editable | **M** |

---

## 4. Logic Definition (로직 정의)

### 4.1 초기화 및 공통 로직
*   **공통코드 로드:** 화면 오픈 시 계약구분(144), 산업군(140), 부가세구분(131), 결재방법(143) 등의 공통코드를 호출하여 콤보박스 등을 구성합니다.
*   **기본값 설정:** 등록/수정일시는 DB `sysdate`, 등록/수정자는 로그인 사용자, 사용여부 기본값은 '전체'로 설정됩니다.

### 4.2 유효성 검사 (Validation Rules)
*   **날짜 정합성:** `조회기간 From` <= `조회기간 To` 여야 합니다.
*   **계약 날짜 순서:** `최초계약일자` <= `계약시작일` < `계약종료일` < `계약연장일자` 순서가 유지되어야 하며, `계약시작일`은 `오더접수가능일자`보다 같거나 커야 합니다.
*   **영업사원 기여도:** 등록된 영업담당자들의 기여도 합계는 반드시 **100%**여야 합니다.
*   **대표 담당자:** 영업담당자 중 '대표여부' 체크는 1명만 가능합니다.
*   **필수 체크:** 거래처코드가 등록되어 있지 않거나 사업자등록증이 없는 경우 신규 등록이 불가합니다.

### 4.3 업무 처리 로직 (Business Logic)
*   **매출계약번호 생성 규칙:** 구분(1자리) + 년월일(8자리) + 순번(4자리) = 총 13자리로 생성됩니다. (예: 매출(1), 매입(2)).
*   **거래처 정보 연동:** 거래처 선택 시, 거래처 테이블(`TB_CM04001`)에서 사업자번호, 부가세구분, 결재유형 정보를 가져와 자동으로 설정합니다.
*   **고객 구분 자동 설정:** 고객 정보 탭에서 고객구분은 10~40번까지 기본 설정되며 수정 가능합니다.
*   **삭제 로직:** 물리적 삭제 대신 `사용여부` 필드를 '아니오'로 업데이트합니다. 단, 계약번호가 아직 발급되지 않은(저장 전) 행은 목록에서 즉시 제거(Clear)됩니다.
*   **이력 관리:** 정보 수정 시 `TB_CM05011`(매출계약 변경이력) 테이블에 수정 전 데이터를 저장하여 이력을 남깁니다.
*   **팝업 연동:** 법인, 거래처, 부서, 사원, 금융기관 선택 시 각각의 공통 팝업을 호출하여 코드를 반환받습니다.
