# PRD: 고객거래처관리 (Customer Business Acquaintance Management)

## 1. User Flow (화면 흐름)

사용자가 시스템에 진입하여 고객거래처 정보를 조회, 등록, 수정하는 유기적인 흐름은 다음과 같습니다.

1.  **초기 진입 (Initialization)**
    *   화면 오픈 시 조회 조건(고객거래처구분, 그룹구분 등)의 콤보 박스 데이터가 로드됩니다. 구분 값은 기본적으로 "전체"로 설정됩니다.
    *   등록일시/수정일시는 현재 시스템 날짜(sysdate), 등록자/수정자는 현재 로그인한 사용자로 초기화됩니다.

2.  **검색 (Search)**
    *   사용자가 검색 조건(거래처코드, 법인, 사업자번호 등)을 입력하고 `검색` 버튼을 클릭합니다.
    *   조건에 맞는 **고객거래처목록**이 상단 그리드에 조회됩니다.

3.  **상세 정보 조회 (Detail View)**
    *   상단 목록에서 특정 행(Row)을 선택합니다.
    *   하단 탭 영역(기본정보, 추가정보, 담당자, 작업장, 변경이력)에 해당 거래처의 상세 정보가 바인딩됩니다.

4.  **정보 등록 및 수정 (Create & Update)**
    *   **신규 등록:** `행추가` 버튼 클릭 시 목록에 신규 레코드가 생성되며, 하단 탭에 정보를 입력할 수 있는 상태가 됩니다.
    *   **수정:** 기존 데이터를 조회 후 하단 탭의 필드 값을 수정합니다.
    *   **팝업 활용:** 거래처, 법인, 국가, 사원, 우편번호, 사용자 등의 필드 옆 `찾기` 아이콘 클릭 시 전용 팝업이 호출되어 값을 선택합니다.
    *   **저장:** `저장` 버튼 클릭 시 DB에 반영됩니다. 수정 시에는 변경 이력이 별도 테이블에 저장됩니다.

5.  **삭제 (Delete)**
    *   **논리적 삭제:** `행삭제` 버튼 클릭 시, 이미 DB에 저장된 데이터인 경우 '사용여부'를 '아니오(No)'로 변경하여 저장합니다(실제 레코드 삭제 아님).
    *   **행 삭제:** 아직 저장되지 않은 신규 행이나 하단 탭(담당자, 작업장)의 목록인 경우 그리드에서 행이 삭제(Clear)됩니다.

---

## 2. UI Component 리스트

화면은 크게 **검색 영역**, **목록 영역(Master)**, **상세 탭 영역(Detail)**으로 구성됩니다.

### 2.1 검색 영역 (Header)
| 컴포넌트명 | 타입 | 설명 |
| :--- | :--- | :--- |
| 거래처코드/명 | InputText + Popup | 거래처 검색 및 선택 |
| 관리법인 | InputText + Popup | 관리 법인 선택 (필수) |
| 고객거래처코드/명 | InputText | 직접 입력 조회 |
| 사업자등록번호 | InputText | 사업자번호 조회 (Format: ###-###-####) |
| 고객거래처구분그룹 | ComboBox | 기타코드 03번 연동 |
| 고객거래처구분 | ComboBox | 기타코드 04번 연동 (그룹 선택 시 필터링) |
| 사용여부 | ComboBox | 전체/예/아니오 선택 |
| 검색 버튼 | Button | 조회 이벤트 트리거 |

### 2.2 고객거래처 목록 영역 (Master Grid)
| 컴포넌트명 | 타입 | 설명 |
| :--- | :--- | :--- |
| 목록 그리드 | DataGrid | 거래처코드, 거래처명, 구분, 관리법인, 국가, 사용여부 등 표시 |
| 행추가 버튼 | Button | 신규 등록을 위한 행 추가 |
| 행취소(삭제) 버튼 | Button | 선택 행 삭제 또는 사용여부 'No' 처리 |

### 2.3 상세 정보 탭 영역 (Detail Tabs)
하단은 5개의 탭으로 구성됩니다.

*   **Tab 1: 고객거래처기본정보**
    *   입력 필드: 고객거래처코드(자동생성), 법인, 사업자번호, 국가, 주소, 대표영업사원 등.
    *   Popups: 법인선택, 국가선택, 사원선택, 우편번호선택.
    *   Combo: 그룹구분, 구분, 종류, 1회성거래처여부, 사용여부.
*   **Tab 2: 고객거래처추가정보**
    *   입력 필드: 회사약호, 영문명, 영문주소, 대표전화, 홈페이지, 업종/업태.
    *   Combo: 인터페이스여부.
*   **Tab 3: 고객거래처담당자**
    *   Grid: 담당자 목록 (이름, 부서, 연락처 등).
    *   Actions: 행추가, 행삭제, 담당자/시스템사용자 팝업.
*   **Tab 4: 고객거래처작업장**
    *   Grid: 작업장 목록 (법인, 국가, 작업장명 등).
    *   Actions: 행추가, 행삭제, 작업장선택 팝업.
*   **Tab 5: 고객거래처변경이력**
    *   Grid: 변경테이블명, 컬럼명, 변경 전/후 내용, 수정자 정보 (ReadOnly).
*   **공통 Action:** `저장` 버튼 (화면 최하단).

---

## 3. Data Mapping

### 3.1 Search & List (Master)
| 한글명 | 영문명(ID) | 속성/타입 | 비고 |
| :--- | :--- | :--- | :--- |
| 거래처코드 | bzacCd | Editable | 팝업 연동 |
| 관리법인 | mngtCorpCd | Editable | **필수(Mandatory)** |
| 사업자등록번호 | bizno | Editable | Format: ###-###-#### |
| 고객거래처구분그룹 | custBzacSctnGrpCd | Editable | **필수**, 공통코드 연동 |

### 3.2 Basic Info Tab (Detail)
| 한글명 | 영문명(ID) | 속성/타입 | 비고 |
| :--- | :--- | :--- | :--- |
| 고객거래처코드 | custBzacCd | Editable | **필수**, 8자리 숫자 자동생성 |
| 고객거래처명 | custBzacNmCd | Editable | **필수** |
| 고객거래처종류 | custBzacKindCd | Editable | **필수**, 기타코드 05번 |
| 국가 | ctryCd | Editable | **필수**, 팝업 연동 |
| 대표영업사원 | rptSalesEmpCd | Editable | **필수**, 팝업 연동 |
| 주소/상세주소 | addrCd / dtlAddrCd | Editable | **필수**, 우편번호 팝업 연동 |
| 등록자/수정자 | regrCd / mdfrCd | ReadOnly | 시스템 자동 입력 |

---

## 4. Logic Definition

### 4.1 초기화 및 공통 로직 (Initialization)
*   **코드 로드:** 화면 오픈 시 기타코드에서 고객거래처그룹구분(03), 고객거래처구분(04), 고객거래처종류(05) 정보를 가져와 콤보박스를 구성합니다.
*   **팝업 자동 선택:** 거래처, 법인, 국가, 사원 등 팝업 호출 시 조회 결과가 1건일 경우, 팝업을 띄우지 않고 자동으로 해당 값을 화면에 세팅합니다.

### 4.2 필드 제어 및 유효성 검사 (Interaction Logic)
*   **계층형 콤보박스:** '고객거래처 그룹구분' 선택 시, 해당 그룹의 상위 코드에 해당하는 '고객거래처 구분' 데이터만 필터링되어 표시됩니다.
*   **작업장 선택 연동:** '고객거래처작업장' 탭에서 작업장 선택 시, 작업장 구분 및 담당자 데이터가 자동으로 선택됩니다.
*   **법인/국가 연동:** 작업장 탭에서 법인 선택 시, 연동된 국가 코드가 1건이면 자동 선택됩니다.

### 4.3 CRUD 및 비즈니스 로직 (Business Logic)
*   **고객거래처번호 생성:** 저장 시 무의미한 숫자 8자리로 생성하여 부여합니다.
*   **대표고객거래처 중복 허용:** 대표고객거래처 코드가 등록된 경우에는 사업자등록번호의 중복을 허용합니다.
*   **저장 (Save):**
    *   수정으로 판단되는 경우 `TB_CM04007`(고객거래처 변경이력) 테이블에 변경 전 데이터를 이력으로 저장합니다 (순번 추가).
    *   모든 탭(기본정보, 추가정보, 담당자, 작업장)의 변경 사항을 한 번에 저장합니다.
*   **삭제 (Delete):**
    *   기존 데이터 삭제 시 레코드를 물리적으로 지우지 않고, `사용여부` 컬럼만 '아니오(No)'로 업데이트합니다.
    *   단, 고객거래처번호가 발급되지 않은(저장 전) 상태의 데이터는 그리드에서 즉시 제거(Clear)합니다.
