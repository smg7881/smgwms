# PRD: 금융기관 선택 팝업 (Financial Institution Selection Popup)

## 1. User Flow
사용자가 금융기관 정보를 검색하고, 특정 금융기관을 선택하여 부모 창(Parent Window)에 값을 전달하는 흐름입니다.

1.  **팝업 호출 (Start)**
    *   사용자가 상위 화면에서 금융기관 검색 기능을 트리거합니다.
    *   시스템은 호출 프로그램에서 전달받은 기본 조건(국가코드 등)을 설정하여 팝업을 엽니다.
2.  **초기화 및 조회 조건 입력**
    *   **국가코드**: 사용자 시스템 정보의 국가코드가 기본값으로 설정됩니다.
    *   **사용여부**: 'YES'(사용 중)가 기본값으로 설정됩니다.
    *   사용자는 필요에 따라 금융기관코드, 금융기관명, 국가, 사용여부를 수정 입력합니다.
    *   (옵션) 국가 선택 시, 조회된 국가가 1건일 경우 팝업 없이 자동 입력되고, 다수일 경우 '국가선택 팝업'이 호출됩니다.
3.  **검색 실행 (Search)**
    *   사용자가 '검색' 버튼을 클릭합니다.
    *   시스템은 입력된 조건(금융기관코드, 명칭, 사용여부, 국가)에 매칭되는 금융기관 목록을 조회합니다.
4.  **목록 확인 및 선택 (Select)**
    *   조회된 그리드 목록(국가, 코드, 명칭, 영문명)을 확인합니다.
    *   사용자가 원하는 금융기관 행(Row)을 클릭(선택)합니다.
5.  **데이터 반환 및 종료 (Return & Close)**
    *   선택된 금융기관 정보(코드, 명칭, 영문명, 국가)가 부모 창으로 전달됩니다.
    *   팝업이 자동으로 닫힙니다.
    *   (대안 흐름) 사용자가 '닫기' 버튼을 클릭하면 값 전달 없이 팝업이 종료됩니다.

---

## 2. UI Component 리스트

### 2.1 조회 영역 (Search Condition)
| Label (Kor) | UI Type | Field Name (Eng) | Description / 속성 |
| :--- | :--- | :--- | :--- |
| **국가코드** | InputBox + Search | `ctryCd` | 국가 검색 및 입력 (Editable) |
| **금융기관코드** | InputBox | `fncOrCd` | 금융기관 코드 입력 (Editable) |
| **금융기관명** | InputBox | `fncOrNm` | 금융기관 명칭 입력 (Editable) |
| **사용여부** | ComboBox | `useYnCd` | 'YES'/'NO' 선택 (Editable, Choice). 기본값: YES |
| **검색** | Button | `btn_Search` | 조회 이벤트 트리거 |

### 2.2 목록 영역 (Grid List)
| Header (Kor) | Field Name (Eng) | Description / 속성 |
| :--- | :--- | :--- |
| **No** | - | 행 번호 (Sequence) |
| **국가** | `fncOrCtry` | 금융기관 국가 (ReadOnly) |
| **금융기관코드** | `fncOrCd` | 금융기관 식별 코드 (ReadOnly) |
| **금융기관명** | `fncOrNm` | 금융기관 명칭 (ReadOnly) |
| **금융기관영문명** | `fncOrEngNm` | 금융기관 영문 명칭 (ReadOnly) |
| **Scroll Bar** | - | 목록이 길어질 경우 스크롤 제공 |

### 2.3 하단 영역 (Footer)
| Label (Kor) | UI Type | Description |
| :--- | :--- | :--- |
| **닫기** | Button | 팝업 종료 |

---

## 3. Data Mapping

### 3.1 Input Data (Open & Search Request)
팝업 오픈 시 또는 검색 버튼 클릭 시 서버/DB로 요청되는 데이터입니다.

*   **금융기관코드 (`fncOrCd`)**: 사용자 입력값 또는 호출 프로그램 전달값.
*   **금융기관명 (`fncOrNm`)**: 사용자 입력값.
*   **사용여부 (`useYnCd`)**: 'Y' 또는 'N'. (값이 없을 경우 'Y' 기본 설정).
*   **국가코드 (`ctryCd`)**: 사용자 시스템 정보의 국가코드 또는 입력값.
*   **로그인ID**: 세션 정보.
*   **DB sysdate**: 시스템 날짜.

### 3.2 Output Data (Response & Return)
그리드에 출력되거나 부모 창으로 반환되는 데이터입니다.

*   **금융기관코드 (`fncOrCd`)**: 선택된 금융기관의 코드.
*   **금융기관명 (`fncOrNm`)**: 선택된 금융기관의 한글 명칭.
*   **금융기관 영문명 (`fncOrEngNm`)**: 선택된 금융기관의 영문 명칭.
*   **금융기관국가 (`fncOrCtry`)**: 선택된 금융기관의 소속 국가 코드/명.

---

## 4. Logic Definition

### 4.1 초기화 로직 (OnLoad)
*   **기본값 설정**:
    *   호출 프로그램(부모 창)에서 파라미터를 넘겨받은 경우 해당 값을 조회 조건에 매핑합니다.
    *   **국가코드**: 로그인한 사용자 시스템 정보에서 기본값을 가져와 설정합니다.
    *   **사용여부**: 기본적으로 '사용(Y)' 상태인 데이터만 조회하도록 설정합니다.

### 4.2 조회 로직 (Search Operation)
*   **통합 관리**: 종합물류에서 사용하는 금융기관 코드를 통합 관리 기준에 따라 조회합니다.
*   **필터링**:
    *   입력된 금융기관코드, 명칭, 국가코드에 해당하는 데이터를 DB에서 `LIKE` 또는 `EQUALS` 검색합니다.
    *   사용여부는 사용자가 수정을 통해 '사용 안 함(N)' 또는 전체 조회가 가능해야 합니다.
*   **국가선택 팝업 연동**:
    *   국가코드 검색 시 `[공통.국가선택 팝업]`을 호출합니다.
    *   만약 조회된 국가코드/국가명이 1건일 경우, 팝업을 띄우지 않고 즉시 필드에 값을 표시합니다.

### 4.3 선택 및 종료 로직 (Select & Close)
*   **행 선택 (Row Select)**:
    *   그리드 내의 특정 행을 클릭하면 `금융기관선택클릭` 이벤트가 발생합니다.
    *   선택된 행의 `금융기관코드`, `금융기관명`, `영문명`, `국가코드` 데이터를 패키징합니다.
    *   패키징된 데이터를 부모 창(Opener)으로 전송(Return)하고 현재 팝업 창을 닫습니다 (Window.close).
*   **닫기 버튼**:
    *   데이터 반환 없이 창을 강제 종료합니다.
