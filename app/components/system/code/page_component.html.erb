<div data-controller="code-grid"
     data-action="ag-grid:ready->code-grid#registerGrid"
     data-code-grid-master-batch-url-value="<%= master_batch_save_url %>"
     data-code-grid-detail-batch-url-template-value="<%= detail_batch_save_url_template %>"
     data-code-grid-detail-list-url-template-value="/system/code/:code/details.json"
     data-code-grid-selected-code-value="<%= selected_code.to_s %>">
  <%= render Ui::SearchFormComponent.new(
    url: create_url,
    fields: search_fields,
    cols: 3,
    enable_collapse: true
  ) %>

  <div class="grid grid-cols-2 gap-3 max-[1200px]:grid-cols-1">
    <section class="min-w-0">
      <div class="flex items-center justify-between gap-3 mb-3 mt-2">
        <h3 class="inline-flex items-center gap-2 text-[15px] font-semibold text-text-primary">
          <%= helpers.lucide_icon("list", css_class: "w-4 h-4 text-text-secondary") %>
          코드 목록
          <%= render Ui::GridActionsComponent.new(grid_id: "code-master") %>
        </h3>
        <%= render Ui::GridToolbarComponent.new(
          buttons: [
            { label: "행추가", class: "btn btn-sm btn-primary", action: "click->code-grid#addMasterRow" },
            { label: "행삭제", class: "btn btn-sm btn-danger", action: "click->code-grid#deleteMasterRows" },
            { label: "저장", class: "btn btn-sm btn-success", action: "click->code-grid#saveMasterRows" }
          ]
        ) %>
      </div>

      <%= render Ui::AgGridComponent.new(
        columns: master_columns,
        url: grid_url,
        height: "calc(100vh - 420px)",
        page_size: 20,
        row_selection: "multiple",
        grid_id: "code-master",
        data: { code_grid_target: "masterGrid" }
      ) %>
    </section>

    <section class="min-w-0">
      <div class="flex items-center justify-between gap-3 mb-3 mt-2">
        <div class="flex items-end gap-2">
          <h3 class="inline-flex items-center gap-2 text-[15px] font-semibold text-text-primary">
            <%= helpers.lucide_icon("list-tree", css_class: "w-4 h-4 text-text-secondary") %>
            상세코드 목록
            <%= render Ui::GridActionsComponent.new(grid_id: "code-detail") %>
          </h3>
          <p class="text-text-secondary text-xs" data-code-grid-target="selectedCodeLabel"><%= selected_code_label %></p>
        </div>
        <%= render Ui::GridToolbarComponent.new(
          buttons: [
            { label: "행추가", class: "btn btn-sm btn-primary", action: "click->code-grid#addDetailRow" },
            { label: "행삭제", class: "btn btn-sm btn-danger", action: "click->code-grid#deleteDetailRows" },
            { label: "저장", class: "btn btn-sm btn-success", action: "click->code-grid#saveDetailRows" }
          ]
        ) %>
      </div>

      <% if detail_grid_url.present? %>
        <%= render Ui::AgGridComponent.new(
          columns: detail_columns,
          url: detail_grid_url,
          height: "calc(100vh - 420px)",
          page_size: 20,
          row_selection: "multiple",
          grid_id: "code-detail",
          data: { code_grid_target: "detailGrid" }
        ) %>
      <% else %>
        <%= render Ui::AgGridComponent.new(
          columns: detail_columns,
          row_data: [],
          height: "calc(100vh - 420px)",
          page_size: 20,
          row_selection: "multiple",
          grid_id: "code-detail",
          data: { code_grid_target: "detailGrid" }
        ) %>
      <% end %>
    </section>
  </div>
</div>
