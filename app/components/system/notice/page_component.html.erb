<div data-controller="notice-crud"
     data-notice-crud-create-url-value="<%= create_url %>"
     data-notice-crud-update-url-value="<%= update_url %>"
     data-notice-crud-delete-url-value="<%= delete_url %>"
     data-notice-crud-bulk-delete-url-value="<%= bulk_delete_url %>">
  <%= render Ui::SearchFormComponent.new(
    url: create_url,
    fields: search_fields,
    cols: 3,
    enable_collapse: true
  ) %>

  <div class="flex items-center justify-between gap-3 mb-3 mt-2">
    <h3 class="inline-flex items-center gap-2 text-[15px] font-semibold text-text-primary">
      <%= helpers.lucide_icon("bell", css_class: "w-4 h-4 text-text-secondary") %>
      공지사항 목록
      <%= render Ui::GridActionsComponent.new(grid_id: "system-notice") %>
    </h3>
    <%= render Ui::GridToolbarComponent.new(
      buttons: [
        { label: "등록", class: "btn btn-sm btn-primary", action: "click->notice-crud#openCreate" },
        { label: "선택삭제", class: "btn btn-sm btn-secondary", action: "click->notice-crud#deleteSelected" }
      ]
    ) %>
  </div>

  <%= render Ui::AgGridComponent.new(
    columns: columns,
    url: grid_url,
    height: "calc(100vh - 370px)",
    page_size: 20,
    row_selection: "multiple",
    grid_id: "system-notice"
  ) %>

  <%= render Ui::ModalShellComponent.new(
    controller: "notice-crud",
    title: "공지사항 등록",
    save_form_id: "notice-crud-form",
    cancel_role: "cancel",
    save_role: "save"
  ) do |modal| %>
    <% modal.with_body do %>
      <input type="hidden" data-notice-crud-target="fieldId" />

      <%= render Ui::ResourceFormComponent.new(
        model: AdmNotice.new,
        url: "#",
        cols: 2,
        show_buttons: false,
        target_controller: "notice_crud",
        fields: form_fields,
        form_data: {
          notice_crud_target: "form",
          action: "submit->resource-form#submit submit->notice-crud#submit"
        },
        form_html: {
          id: "notice-crud-form",
          novalidate: true,
          autocomplete: "off"
        }
      ) %>

      <div class="rounded-lg border border-border bg-bg-secondary p-4">
        <label class="mb-2 block text-sm font-medium text-text-secondary" for="notice-attachments">첨부파일</label>
        <input id="notice-attachments"
               type="file"
               multiple
               class="form-grid-input"
               data-notice-crud-target="fieldAttachments"
               data-action="change->notice-crud#handleFileInputChange">
        <p class="mt-2 text-xs text-text-muted">수정 시 파일을 선택하면 기존 첨부에 추가됩니다.</p>
        <ul class="mt-2 list-disc pl-5 text-sm text-text-primary" data-notice-crud-target="existingFiles"></ul>
      </div>
    <% end %>
  <% end %>
</div>
