  <!-- 검색조건 (resource_form 활용) -->
  <%= render Ui::SearchFormComponent.new(
    url: collection_path(format: :json),
    fields: search_fields,
    cols: 4,
    enable_collapse: true
  ) %>

  <!-- 에이지 그리드 -->
  <div class="mt-4 flex flex-col flex-1 h-full min-h-[500px]" 
       data-controller="om-waiting-order-grid"
       data-om-waiting-order-grid-distribute-url-value="<%= distribute_path %>">
    
    <!-- 툴바 -->
    <%= render Ui::GridToolbarComponent.new do |toolbar| %>
      <% toolbar.with_left do %>
        <span class="font-medium text-gray-700">대기오더 목록</span>
      <% end %>
      
      <% toolbar.with_right do %>
        <button type="button" class="btn btn-primary" data-action="click->om-waiting-order-grid#distributeOrders">
          <i data-lucide="share-2" class="w-4 h-4 mr-2"></i> 오더분배
        </button>
        <button type="button" class="btn btn-secondary" data-action="click->om-waiting-order-grid#checkAvailableStock">
          <i data-lucide="refresh-cw" class="w-4 h-4 mr-2"></i> 가용재고조회
        </button>
      <% end %>
    <% end %>

    <!-- 마스터 그리드 -->
    <%= render Ui::AgGridComponent.new(
      url: grid_url,
      columns: [
        { field: "ord_stat_cd", headerName: "오더상태", width: 100 },
        { field: "ord_no", headerName: "오더번호", width: 130 },
        { field: "ord_type_cd", headerName: "오더유형", width: 100 },
        { field: "create_time", headerName: "오더생성일시", width: 150 },
        { field: "aptd_req_ymd", headerName: "고객납기요청", width: 120 },
        { field: "dpt_ar_nm", headerName: "출발지", width: 150 },
        { field: "arv_ar_nm", headerName: "도착지", width: 150 },
        { field: "item_cd", headerName: "아이템코드", width: 120 },
        { field: "item_nm", headerName: "아이템명", width: 200 },
        { field: "ord_qty", headerName: "오더수량", headerClass: "text-right", cellClass: "text-right", type: "numericColumn" },
        { field: "avail_qty", headerName: "가용재고", headerClass: "text-right text-blue-600 font-bold", cellClass: "text-right text-blue-600 font-bold", type: "numericColumn" },
        { field: "dist_qty", headerName: "분배 수량 (입력)", editable: true, headerClass: "text-right text-green-600 bg-green-50", cellClass: "text-right bg-green-50", type: "numericColumn",
          valueParser: "Number(newValue)",
          valueSetter: "params.data.dist_qty = Math.min(Number(newValue) || 0, Math.min(params.data.avail_qty || 0, params.data.ord_qty || 0)); return true;"
        },
        { field: "remain_qty", headerName: "잔여수량", headerClass: "text-right text-red-500", cellClass: "text-right text-red-500", type: "numericColumn",
          valueGetter: "Number(data.ord_qty || 0) - Number(data.dist_qty || 0)"
        }
      ],
      row_selection: "multiple",
      data: {
        om_waiting_order_grid_target: "grid",
        action: "ag-grid:grid-ready->om-waiting-order-grid#onGridReady search-form:success@window->om-waiting-order-grid#reload"
      }
    ) %>
  </div>
