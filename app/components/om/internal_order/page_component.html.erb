<div data-controller="om-internal-order"
       data-om-internal-order-search-url-value="<%= search_url %>"
       data-om-internal-order-create-url-value="<%= create_url %>"
       data-om-internal-order-update-url-value="<%= update_url %>"
       data-om-internal-order-cancel-url-value="<%= cancel_url %>">

    <!-- 검색 조건 및 상단 툴바 영역 -->
    <div class="flex justify-between items-end mb-4">
      <!-- 좌측 검색 영역 -->
      <div class="flex items-center space-x-4 bg-white p-3 rounded shadow-sm border">
        <div class="flex items-center space-x-2">
          <label class="font-medium text-sm text-gray-700 whitespace-nowrap">오더번호</label>
          <%= text_field_tag "search_ord_no", nil,
                class: "form-input w-48 text-sm",
                placeholder: "오더번호 입력",
                data: { om_internal_order_target: "searchOrdNo",
                        action: "keydown.enter->om-internal-order#search" } %>
          <button type="button" class="btn btn-secondary px-3" data-action="click->om-internal-order#search">
            <i data-lucide="search" class="w-4 h-4"></i>
          </button>
        </div>
      </div>

      <!-- 우측 툴바 버튼 영역 -->
      <div class="space-x-2">
        <button type="button" class="btn btn-primary" data-action="click->om-internal-order#newOrder">
          <i data-lucide="plus" class="w-4 h-4 mr-2"></i> 신규
        </button>
        <button type="button" class="btn btn-success" data-action="click->om-internal-order#saveOrder"
                data-om-internal-order-target="saveBtn">
          <i data-lucide="save" class="w-4 h-4 mr-2"></i> 저장
        </button>
        <button type="button" class="btn btn-danger" data-action="click->om-internal-order#cancelOrder"
                data-om-internal-order-target="cancelBtn">
          <i data-lucide="x-circle" class="w-4 h-4 mr-2"></i> 오더취소
        </button>
      </div>
    </div>

    <!-- 마스터 : 오더 헤더 폼 -->
    <div class="bg-white p-4 rounded shadow-sm border mb-4" data-om-internal-order-target="headerForm">
      <h3 class="text-sm font-bold text-gray-800 mb-3 border-b pb-2">기본 정보</h3>

      <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4">
        <!-- 1 Row : 읽기전용 -->
        <div class="form-group flex items-center space-x-2">
          <label class="font-medium text-sm text-gray-700 w-28">오더번호</label>
          <input type="text" class="form-input flex-1 text-sm font-bold text-blue-600 bg-gray-100"
                 readonly data-om-internal-order-target="fieldOrdNo" placeholder="저장 시 자동 채번">
        </div>
        <div class="form-group flex items-center space-x-2">
          <label class="font-medium text-sm text-gray-700 w-28">오더상태</label>
          <input type="text" class="form-input flex-1 text-sm bg-gray-100"
                 readonly data-om-internal-order-target="fieldOrdStatCd">
        </div>
        <div class="form-group flex items-center space-x-2">
          <label class="font-medium text-sm text-gray-700 w-28">생성일시</label>
          <input type="text" class="form-input flex-1 text-sm bg-gray-100"
                 readonly data-om-internal-order-target="fieldCreateTime">
        </div>
        <div class="form-group flex items-center space-x-2">
          <label class="font-medium text-sm text-gray-700 w-28">오더유형</label>
          <%= select_tag "order[ord_type_cd]",
                options_for_select(common_code_options("75"), nil),
                include_blank: "선택",
                class: "form-select flex-1 text-sm",
                disabled: true,
                data: { om_internal_order_target: "fieldOrdTypeCd" } %>
        </div>

        <!-- 2 Row -->
        <div class="form-group flex items-center space-x-2">
          <label class="font-medium text-sm text-gray-700 w-28">계약번호</label>
          <input type="text" name="order[ctrt_no]" class="form-input flex-1 text-sm"
                 disabled data-om-internal-order-target="fieldCtrtNo">
        </div>
        <div class="form-group flex items-center space-x-2">
          <label class="font-medium text-sm text-gray-700 w-28">청구고객</label>
          <div class="flex-1 flex items-center space-x-1" data-controller="search-popup" data-search-popup-type-value="client">
            <input type="text" name="order[bilg_cust_cd]" class="form-input w-24 text-sm bg-gray-50"
                   readonly disabled
                   data-om-internal-order-target="fieldBilgCustCd"
                   data-search-popup-target="code">
            <input type="text" class="form-input flex-1 text-sm bg-gray-50"
                   readonly data-om-internal-order-target="fieldBilgCustNm"
                   data-search-popup-target="name">
            <button type="button" class="btn btn-secondary px-2" data-action="search-popup#open" disabled
                    data-om-internal-order-target="bilgCustSearchBtn">
              <i data-lucide="search" class="w-4 h-4"></i>
            </button>
          </div>
        </div>
        <div class="form-group flex items-center space-x-2">
          <label class="font-medium text-sm text-gray-700 w-28">계약고객</label>
          <div class="flex-1 flex items-center space-x-1" data-controller="search-popup" data-search-popup-type-value="client">
            <input type="text" name="order[ctrt_cust_cd]" class="form-input w-24 text-sm bg-gray-50"
                   readonly disabled
                   data-om-internal-order-target="fieldCtrtCustCd"
                   data-search-popup-target="code">
            <input type="text" class="form-input flex-1 text-sm bg-gray-50"
                   readonly data-om-internal-order-target="fieldCtrtCustNm"
                   data-search-popup-target="name">
            <button type="button" class="btn btn-secondary px-2" data-action="search-popup#open" disabled
                    data-om-internal-order-target="ctrtCustSearchBtn">
              <i data-lucide="search" class="w-4 h-4"></i>
            </button>
          </div>
        </div>
        <div class="form-group flex items-center space-x-2">
          <label class="font-medium text-sm text-gray-700 w-28">사유코드</label>
          <%= select_tag "order[ord_reason_cd]",
                options_for_select(common_code_options("87"), nil),
                include_blank: "선택",
                class: "form-select flex-1 text-sm",
                disabled: true,
                data: { om_internal_order_target: "fieldOrdReasonCd" } %>
        </div>

        <!-- 3 Row -->
        <div class="form-group flex items-center space-x-2">
          <label class="font-medium text-sm text-gray-700 w-28">실행부서</label>
          <input type="text" name="order[ord_exec_dept_cd]" class="form-input w-24 text-sm"
                 disabled data-om-internal-order-target="fieldOrdExecDeptCd">
          <input type="text" name="order[ord_exec_dept_nm]" class="form-input flex-1 text-sm"
                 disabled data-om-internal-order-target="fieldOrdExecDeptNm">
        </div>
        <div class="form-group flex items-center space-x-2">
          <label class="font-medium text-sm text-gray-700 w-28">실행담당자</label>
          <input type="text" name="order[ord_exec_ofcr_cd]" class="form-input w-24 text-sm"
                 disabled data-om-internal-order-target="fieldOrdExecOfcrCd">
          <input type="text" name="order[ord_exec_ofcr_nm]" class="form-input flex-1 text-sm"
                 disabled data-om-internal-order-target="fieldOrdExecOfcrNm">
        </div>
        <div class="form-group flex items-center space-x-2 col-span-2">
          <label class="font-medium text-sm text-gray-700 w-28">특이사항</label>
          <input type="text" name="order[remk]" class="form-input flex-1 text-sm"
                 disabled data-om-internal-order-target="fieldRemk">
        </div>
      </div>
    </div>

    <!-- 탭 영역 : 출도착지상세 / 아이템상세 -->
    <div class="bg-white rounded shadow-sm border">
      <!-- 탭 헤더 -->
      <div class="flex border-b">
        <button type="button" class="px-4 py-2 text-sm font-medium border-b-2 border-blue-500 text-blue-600"
                data-action="click->om-internal-order#switchTab"
                data-om-internal-order-target="tabBtnLocation"
                data-tab="location">
          출도착지상세
        </button>
        <button type="button" class="px-4 py-2 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700"
                data-action="click->om-internal-order#switchTab"
                data-om-internal-order-target="tabBtnItems"
                data-tab="items">
          아이템상세
        </button>
      </div>

      <!-- 출도착지상세 탭 -->
      <div class="p-4" data-om-internal-order-target="tabLocation">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- 출발지 그룹 -->
          <div class="bg-gray-50 p-3 rounded border">
            <div class="font-semibold text-gray-700 mb-2">출발지 정보</div>
            <div class="space-y-3">
              <div class="flex items-center space-x-2">
                <label class="text-sm w-24 text-gray-600">유형</label>
                <%= select_tag "order[dpt_type_cd]",
                      options_for_select(loc_type_options, nil),
                      include_blank: "선택",
                      class: "form-select flex-1 text-sm",
                      disabled: true,
                      data: { om_internal_order_target: "fieldDptTypeCd",
                              action: "change->om-internal-order#onDptTypeChange" } %>
              </div>
              <div class="flex items-center space-x-2">
                <label class="text-sm w-24 text-gray-600">코드</label>
                <input type="text" name="order[dpt_cd]" class="form-input flex-1 text-sm"
                       disabled data-om-internal-order-target="fieldDptCd">
              </div>
              <div class="flex items-center space-x-2">
                <label class="text-sm w-24 text-gray-600">우편번호</label>
                <input type="text" name="order[dpt_zip_cd]" class="form-input w-32 text-sm"
                       disabled data-om-internal-order-target="fieldDptZipCd">
              </div>
              <div class="flex items-center space-x-2">
                <label class="text-sm w-24 text-gray-600">주소</label>
                <input type="text" name="order[dpt_addr]" class="form-input flex-1 text-sm"
                       disabled data-om-internal-order-target="fieldDptAddr">
              </div>
              <div class="flex items-center space-x-2">
                <label class="text-sm w-24 text-gray-600">시작요청일</label>
                <input type="date" name="order[strt_req_ymd]" class="form-input flex-1 text-sm"
                       disabled data-om-internal-order-target="fieldStrtReqYmd">
              </div>
            </div>
          </div>

          <!-- 도착지 그룹 -->
          <div class="bg-gray-50 p-3 rounded border">
            <div class="font-semibold text-gray-700 mb-2">도착지 정보</div>
            <div class="space-y-3">
              <div class="flex items-center space-x-2">
                <label class="text-sm w-24 text-gray-600">유형</label>
                <%= select_tag "order[arv_type_cd]",
                      options_for_select(loc_type_options, nil),
                      include_blank: "선택",
                      class: "form-select flex-1 text-sm",
                      disabled: true,
                      data: { om_internal_order_target: "fieldArvTypeCd",
                              action: "change->om-internal-order#onArvTypeChange" } %>
              </div>
              <div class="flex items-center space-x-2">
                <label class="text-sm w-24 text-gray-600">코드</label>
                <input type="text" name="order[arv_cd]" class="form-input flex-1 text-sm"
                       disabled data-om-internal-order-target="fieldArvCd">
              </div>
              <div class="flex items-center space-x-2">
                <label class="text-sm w-24 text-gray-600">우편번호</label>
                <input type="text" name="order[arv_zip_cd]" class="form-input w-32 text-sm"
                       disabled data-om-internal-order-target="fieldArvZipCd">
              </div>
              <div class="flex items-center space-x-2">
                <label class="text-sm w-24 text-gray-600">주소</label>
                <input type="text" name="order[arv_addr]" class="form-input flex-1 text-sm"
                       disabled data-om-internal-order-target="fieldArvAddr">
              </div>
              <div class="flex items-center space-x-2">
                <label class="text-sm w-24 text-gray-600">납기요청일시</label>
                <input type="datetime-local" name="order[aptd_req_dtm]" class="form-input flex-1 text-sm"
                       disabled data-om-internal-order-target="fieldAptdReqDtm">
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- 아이템상세 탭 -->
      <div class="p-4 hidden" data-om-internal-order-target="tabItems">
        <div class="flex justify-between items-center mb-2">
          <h3 class="text-sm font-bold text-gray-800">아이템 목록 (최대 20건)</h3>
          <div class="space-x-1">
            <button type="button" class="btn btn-sm btn-secondary" data-action="click->om-internal-order#addItemRow">
              <i data-lucide="plus" class="w-3 h-3 mr-1"></i> 행추가
            </button>
            <button type="button" class="btn btn-sm btn-danger" data-action="click->om-internal-order#deleteItemRows">
              <i data-lucide="minus" class="w-3 h-3 mr-1"></i> 행삭제
            </button>
          </div>
        </div>

        <div class="h-[300px]">
          <%= render Ui::AgGridComponent.new(
            columns: item_columns,
            row_data: [],
            height: "300px",
            pagination: false,
            row_selection: "multiple",
            grid_id: "om-internal-order-items",
            data: {
              om_internal_order_target: "itemGrid",
              action: "ag-grid:ready->om-internal-order#registerItemGrid"
            }
          ) %>
        </div>
      </div>
    </div>
  </div>
