<div data-controller="std-favorite-grid"
     data-action="ag-grid:ready->std-favorite-grid#registerGrid"
     data-std-favorite-grid-list-url-value="<%= grid_url %>"
     data-std-favorite-grid-batch-url-value="<%= batch_save_url %>"
     data-std-favorite-grid-group-list-url-value="<%= group_list_url %>"
     data-std-favorite-grid-group-batch-url-value="<%= group_batch_save_url %>">
  <%= render Ui::SearchFormComponent.new(
    url: create_url,
    fields: search_fields,
    cols: 3,
    enable_collapse: true
  ) %>

  <section class="mb-5">
    <%= render Ui::GridHeaderComponent.new(
      icon: "folders", title: "즐겨찾기 그룹", grid_id: "std-favorite-group",
      buttons: [
        { label: "추가", class: "btn btn-sm btn-primary", action: "click->std-favorite-grid#addGroupRow" },
        { label: "삭제", class: "btn btn-sm btn-danger", action: "click->std-favorite-grid#deleteGroupRows" },
        { label: "저장", class: "btn btn-sm btn-success", action: "click->std-favorite-grid#saveGroupRows" }
      ]
    ) %>

    <%= render Ui::AgGridComponent.new(
      columns: group_columns,
      row_data: [],
      height: "220px",
      page_size: 20,
      row_selection: "multiple",
      grid_id: "std-favorite-group",
      data: { std_favorite_grid_target: "groupGrid", action: "ag-grid:rowClicked->std-favorite-grid#onGroupRowClicked ag-grid:rowFocused->std-favorite-grid#onGroupRowFocused ag-grid:selectionChanged->std-favorite-grid#onGroupSelectionChanged" }
    ) %>
  </section>

  <section class="mt-5">
    <div class="flex items-center gap-3 mb-4 mt-2">
      <h3 class="inline-flex items-center gap-2 text-lg font-bold text-white">
        <%= helpers.lucide_icon("folder-tree", css_class: "w-5 h-5 text-blue-500") %>
        System Sitemap
      </h3>
      <span class="ml-auto text-sm text-text-secondary">Total <%= sitemap_menus.sum { |m| m[:children].length } %> Menus</span>
    </div>

    <div class="flex flex-nowrap items-start overflow-x-auto pb-4" style="gap: 16px;">
      <% sitemap_menus.each_with_index do |top_menu, idx| %>
        <div class="shrink-0 bg-bg-primary border border-border rounded-lg overflow-hidden flex flex-col shadow-sm" style="width: 220px;">
          <div class="bg-bg-secondary border-b border-border font-bold text-text-primary text-center" style="padding: 8px; font-size: 14px;">
            <%= top_menu[:menu_nm] %>
          </div>
          <div class="flex flex-col bg-bg-primary" style="padding: 8px; gap: 4px;">
            <% top_menu[:children].each do |sub_menu| %>
              <div class="flex items-center justify-between cursor-pointer group hover:bg-bg-hover rounded-md transition-all"
                   style="padding: 6px 10px;"
                   data-action="click->std-favorite-grid#toggleStar"
                   data-menu-cd="<%= sub_menu[:menu_cd] %>"
                   data-menu-nm="<%= sub_menu[:menu_nm] %>">
                <div class="flex flex-row items-center w-full" style="gap: 8px;">
                  <button type="button" class="sitemap-star flex items-center justify-center text-text-muted transition-colors shrink-0" data-std-favorite-grid-target="star" style="width: 14px; height: 14px;">
                    <%= helpers.lucide_icon("star", css_class: "w-full h-full text-inherit fill-current") %>
                  </button>
                  <span class="text-text-secondary font-medium group-hover:text-text-primary transition-colors truncate" style="font-size: 13px; line-height: 14px;"><%= sub_menu[:menu_nm] %></span>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </section>
</div>
