<div class="std-client-screen"
     data-controller="client-grid"
     data-action="ag-grid:ready->client-grid#registerGrid"
     data-client-grid-master-batch-url-value="<%= master_batch_save_url %>"
     data-client-grid-contact-batch-url-template-value="<%= contact_batch_url_template %>"
     data-client-grid-contact-list-url-template-value="<%= contact_list_url_template %>"
     data-client-grid-workplace-batch-url-template-value="<%= workplace_batch_url_template %>"
     data-client-grid-workplace-list-url-template-value="<%= workplace_list_url_template %>"
     data-client-grid-sections-url-value="<%= section_list_url %>"
     data-client-grid-section-map-value="<%= section_map_json %>"
     data-client-grid-selected-client-value="<%= selected_client.to_s %>">
  <%= render Ui::SearchFormComponent.new(
    url: create_url,
    fields: search_fields,
    cols: 4,
    enable_collapse: true,
    class: "std-client-search"
  ) %>

  <section class="std-client-master">
    <%= render Ui::GridHeaderComponent.new(
      icon: "building-2", title: "거래처 목록", grid_id: "std-client-master",
      class: "std-client-section-head", title_class: "std-client-section-title", icon_class: "w-4 h-4",
      buttons: [
        { label: "행추가", class: "btn btn-sm btn-primary", action: "click->client-grid#addMasterRow" },
        { label: "행삭제", class: "btn btn-sm btn-danger", action: "click->client-grid#deleteMasterRows" },
        { label: "저장", class: "btn btn-sm btn-success", action: "click->client-grid#saveMasterRows" }
      ]
    ) %>

    <%= render Ui::AgGridComponent.new(
      columns: master_columns,
      url: grid_url,
      height: "250px",
      page_size: 20,
      row_selection: "multiple",
      grid_id: "std-client-master",
      data: { client_grid_target: "masterGrid" }
    ) %>
  </section>

  <section class="std-client-detail">
    <div class="std-client-selected" data-client-grid-target="selectedClientLabel"><%= selected_client_label %></div>

    <%= render Ui::TabsComponent.new(
      target_controller: "client-grid",
      tabs: [
        { id: "basic", label: "거래처기본정보" },
        { id: "additional", label: "거래처추가정보" },
        { id: "contacts", label: "거래처담당자" },
        { id: "workplaces", label: "거래처작업장" }
      ]
    ) %>

    <div class="std-client-panel is-active" data-client-grid-target="tabPanel" data-tab-panel="basic">
      <%= render Ui::ResourceFormComponent.new(
        model: detail_form_model,
        url: "#",
        cols: 3,
        show_buttons: false,
        target_controller: "client_grid",
        fields: basic_form_fields,
        form_data: detail_form_data,
        form_html: {
          id: "std-client-basic-form",
          autocomplete: "off",
          novalidate: true
        },
        class: "std-client-resource-form"
      ) %>
    </div>

    <div class="std-client-panel" data-client-grid-target="tabPanel" data-tab-panel="additional" hidden>
      <%= render Ui::ResourceFormComponent.new(
        model: detail_form_model,
        url: "#",
        cols: 3,
        show_buttons: false,
        target_controller: "client_grid",
        fields: additional_form_fields,
        form_data: detail_form_data,
        form_html: {
          id: "std-client-additional-form",
          autocomplete: "off",
          novalidate: true
        },
        class: "std-client-resource-form"
      ) %>
    </div>

    <div class="std-client-panel" data-client-grid-target="tabPanel" data-tab-panel="contacts" hidden>
      <%= render Ui::GridHeaderComponent.new(
        icon: "users", title: "거래처담당자", grid_id: "std-client-contact",
        class: "std-client-section-head", title_class: "std-client-section-title", icon_class: "w-4 h-4",
        buttons: [
          { label: "행추가", class: "btn btn-sm btn-primary", action: "click->client-grid#addContactRow" },
          { label: "행삭제", class: "btn btn-sm btn-danger", action: "click->client-grid#deleteContactRows" }
        ]
      ) %>

      <%= render Ui::AgGridComponent.new(
        columns: contact_columns,
        row_data: [],
        height: "230px",
        page_size: 20,
        row_selection: "multiple",
        grid_id: "std-client-contact",
        data: { client_grid_target: "contactsGrid" }
      ) %>
    </div>

    <div class="std-client-panel" data-client-grid-target="tabPanel" data-tab-panel="workplaces" hidden>
      <%= render Ui::GridHeaderComponent.new(
        icon: "map-pinned", title: "거래처작업장", grid_id: "std-client-workplace",
        class: "std-client-section-head", title_class: "std-client-section-title", icon_class: "w-4 h-4",
        buttons: [
          { label: "행추가", class: "btn btn-sm btn-primary", action: "click->client-grid#addWorkplaceRow" },
          { label: "행삭제", class: "btn btn-sm btn-danger", action: "click->client-grid#deleteWorkplaceRows" }
        ]
      ) %>

      <%= render Ui::AgGridComponent.new(
        columns: workplace_columns,
        row_data: [],
        height: "230px",
        page_size: 20,
        row_selection: "multiple",
        grid_id: "std-client-workplace",
        data: { client_grid_target: "workplacesGrid" }
      ) %>
    </div>
  </section>
</div>
