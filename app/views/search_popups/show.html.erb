<%
  popup_fields = [
    {
      field: "display",
      type: "input",
      label: "명칭",
      placeholder: "명칭 입력",
      span: "24 s:12 m:12",
      target: "keyword"
    },
    {
      field: "code",
      type: "input",
      label: "코드",
      placeholder: "코드",
      span: "24 s:12 m:8",
      disabled: true,
      target: "code"
    }
  ]

  popup_columns = [
    { field: "name", headerName: "명칭", minWidth: 220, editable: false },
    { field: "code", headerName: "코드", minWidth: 120, maxWidth: 160, editable: false },
    {
      field: "__select",
      headerName: "선택",
      minWidth: 90,
      maxWidth: 90,
      editable: false,
      sortable: false,
      filter: false,
      resizable: false,
      cellStyle: { textAlign: "center" },
      cellRenderer: "popupSelectCellRenderer"
    }
  ]

  popup_rows = @rows.map do |row|
    {
      name: row[:name],
      code: row[:code],
      display: row[:display]
    }
  end
%>

<div class="p-4"
     data-controller="search-popup-grid"
     data-action="ag-grid:ready->search-popup-grid#registerGrid search-popup-grid:select->search-popup-grid#selectFromRenderer">
  <%= render Ui::ResourceFormComponent.new(
    model: @popup_form,
    url: search_popup_path(@type, frame: @frame),
    method: :get,
    fields: popup_fields,
    cols: 3,
    show_buttons: false,
    target_controller: "search_popup_grid",
    form_data: {
      turbo_frame: @frame,
      search_popup_grid_target: "form"
    }
  ) %>

  <div class="flex justify-end mb-3 -mt-2">
    <button type="button"
            class="btn btn-sm btn-secondary inline-flex items-center gap-1.5"
            data-action="search-popup-grid#submitForm"
            aria-label="검색">
      <%= lucide_icon("search", css_class: "w-3.5 h-3.5") %>
      조회
    </button>
  </div>

  <%= render Ui::AgGridComponent.new(
    columns: popup_columns,
    row_data: popup_rows,
    pagination: false,
    row_selection: "single",
    height: "min(56vh, 480px)",
    data: {
      search_popup_grid_target: "grid"
    }
  ) %>
</div>
