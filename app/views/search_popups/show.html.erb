<div class="p-4">
  <%= form_with url: search_popup_path(@type), method: :get,
        data: { turbo_frame: params[:frame].presence || "search_popup_frame" },
        class: "mb-3" do |f| %>
    <%= hidden_field_tag :frame, params[:frame] %>
    <div class="flex items-end gap-2">
      <div class="flex-1">
        <label for="search_popup_q" class="text-xs text-text-secondary mb-1 block">검색어</label>
        <input id="search_popup_q"
               type="text"
               name="q"
               value="<%= @keyword %>"
               class="form-grid-input w-full"
               placeholder="코드 또는 명칭 검색" />
      </div>
      <button type="submit" class="btn btn-sm btn-secondary">조회</button>
    </div>
  <% end %>

  <div class="border border-border rounded-md overflow-hidden">
    <table class="w-full text-sm">
      <thead class="bg-bg-tertiary">
        <tr>
          <th class="text-left px-3 py-2 border-b border-border">코드</th>
          <th class="text-left px-3 py-2 border-b border-border">명칭</th>
          <th class="text-center px-3 py-2 border-b border-border w-20">선택</th>
        </tr>
      </thead>
      <tbody>
        <% if @rows.any? %>
          <% @rows.each do |row| %>
            <tr class="hover:bg-bg-hover cursor-pointer"
                ondblclick="(function(){const modal=document.getElementById('search-popup-modal');if(!modal){return;}modal.dispatchEvent(new CustomEvent('search-popup:select',{detail:{code:'<%= j row[:code].to_s %>',display:'<%= j row[:display].to_s %>'},bubbles:true}));})();">
              <td class="px-3 py-2 border-b border-border"><%= row[:code] %></td>
              <td class="px-3 py-2 border-b border-border"><%= row[:display] %></td>
              <td class="px-3 py-2 border-b border-border text-center">
                <button type="button"
                        class="btn btn-xs btn-primary"
                        onclick="(function(){const modal=document.getElementById('search-popup-modal');if(!modal){return;}modal.dispatchEvent(new CustomEvent('search-popup:select',{detail:{code:'<%= j row[:code].to_s %>',display:'<%= j row[:display].to_s %>'},bubbles:true}));})();">
                  선택
                </button>
              </td>
            </tr>
          <% end %>
        <% else %>
          <tr>
            <td colspan="3" class="px-3 py-4 text-center text-text-secondary">검색 결과가 없습니다.</td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>
