<%# app/views/shared/resource_form/fields/_select.html.erb %>
<%
  field_id = "#{model.model_name.param_key}_#{field[:field]}"
  has_dependency = field[:depends_on].present?
  current_value = model.send(field[:field].to_sym) rescue nil
%>
<div class="flex flex-col gap-1 col-span-24 min-w-0 <%= span_classes_for(field, cols: cols) %>"
     data-resource-form-target="fieldGroup <%= 'dependentField' if has_dependency %>"
     data-field-name="<%= field[:field] %>">
  <label class="text-sm font-medium text-text-secondary" for="<%= field_id %>">
    <%= resolve_label(field) %>
    <% if field[:required] %><span class="text-accent-rose ml-0.5 font-semibold">*</span><% end %>
  </label>
  <div class="flex relative">
    <select id="<%= field_id %>"
            name="<%= "#{model.model_name.param_key}[#{field[:field]}]" %>"
            class="form-grid-select <%= 'rf-field-error' if model.errors[field[:field].to_sym].any? %>"
            <%= "required" if field[:required] %>
            <%= "disabled" if field[:disabled] %>
            <% if has_dependency %>
              data-all-options="<%= (field[:options] || []).to_json %>"
              data-depends-on="<%= field[:depends_on] %>"
              data-depends-filter="<%= field[:depends_filter] || field[:depends_on] %>"
            <% end %>
            <% if field[:target].present? && local_assigns[:target_controller].present? %>
              data-<%= local_assigns[:target_controller].to_s.dasherize %>-target="<%= field[:target] %>"
            <% end %>
            data-resource-form-target="input"
            data-action="<%= has_dependency ? '' : 'change->resource-form#onSelectChange' %> blur->resource-form#validateField">
      <% if field[:include_blank] != false %>
        <option value=""><%= resolve_placeholder(field) || "선택하세요" %></option>
      <% end %>
      <% (field[:options] || []).each do |opt| %>
        <%
          label, value = if opt.is_a?(Hash)
            [opt[:label] || opt["label"], opt[:value] || opt["value"]]
          elsif opt.is_a?(Array)
            [opt.first, opt.last]
          else
            [opt, opt]
          end
        %>
        <option value="<%= value %>" <%= "selected" if current_value.to_s == value.to_s %>><%= label %></option>
      <% end %>
    </select>
  </div>
  <% if model.errors[field[:field].to_sym].any? %>
    <span class="rf-error-msg"><%= model.errors[field[:field].to_sym].first %></span>
  <% end %>
  <% if field[:help].present? %>
    <span class="text-xs text-text-muted mt-0.5"><%= field[:help] %></span>
  <% end %>
</div>
