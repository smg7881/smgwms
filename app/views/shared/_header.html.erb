<header class="h-[var(--spacing-header)] bg-bg-secondary border-b border-border flex items-center px-5 shrink-0">
  <button class="inline-flex items-center justify-center bg-transparent border-none text-text-secondary cursor-pointer py-1 px-2 rounded-md leading-none shrink-0 mr-2 hover:bg-bg-hover hover:text-text-primary transition-[background,color] duration-150" type="button"
          data-action="click->tabs#toggleSidebar"
          aria-label="사이드바 열기/닫기">
    <%= lucide_icon("chevrons-left", css_class: "toggle-icon-collapse") %>
    <%= lucide_icon("chevrons-right", css_class: "toggle-icon-expand") %>
  </button>
  <div class="flex items-center gap-1.5 text-sm text-text-secondary">
    <%= lucide_icon("house", css_class: "w-4 h-4 text-text-secondary") %>
    <span class="text-text-muted">/</span>
    <span id="breadcrumb-current" class="flex items-center gap-2">
      <% active_id = session[:active_tab] || "overview" %>
      <% active_tab = (session[:open_tabs] || []).find { |t| t["id"] == active_id } %>
      <% base_label = active_tab&.dig("label") || TabRegistry.find(active_id)&.label || "대시보드" %>
      <% breadcrumbs = [] %>
      <% if defined?(AdmMenu) && AdmMenu.table_exists? %>
        <% current_menu = AdmMenu.find_by(tab_id: active_id) %>
        <% while current_menu %>
          <% breadcrumbs.unshift(current_menu.menu_nm) %>
          <% current_menu = current_menu.parent %>
        <% end %>
      <% end %>
      <% breadcrumbs = [base_label] if breadcrumbs.empty? %>
      
      <% breadcrumbs.each_with_index do |crumb, index| %>
        <% if index == breadcrumbs.length - 1 %>
          <span class="text-text-secondary"><%= crumb %></span>
        <% else %>
          <span class="text-text-secondary"><%= crumb %></span>
          <span class="text-text-muted">/</span>
        <% end %>
      <% end %>
    </span>
  </div>
  <div class="flex items-center gap-2 ml-auto">
    <div class="flex items-center gap-1.5 bg-bg-primary border border-border rounded-md px-2.5 py-1.5 text-[13px] text-text-secondary">
      <%= lucide_icon("search") %>
      <input type="text" placeholder="검색... (⌘K)"
             class="bg-transparent border-none outline-none text-text-primary text-[13px] w-40 placeholder:text-text-muted">
    </div>
    <div class="relative" data-controller="header-favorites" data-header-favorites-url-value="<%= std_favorites_path(format: :json) %>" data-header-favorites-groups-url-value="<%= groups_std_favorites_path(format: :json) %>">
      <button class="inline-flex items-center justify-center bg-transparent border border-border rounded-md px-2 py-1.5 cursor-pointer text-text-secondary leading-none hover:bg-bg-hover transition-colors duration-150" type="button" aria-label="즐겨찾기" data-action="click->header-favorites#toggle">
        <%= lucide_icon("star", css_class: "w-4 h-4") %>
      </button>
      <div data-header-favorites-target="popup" class="hidden fixed bg-bg-primary border border-border rounded-lg shadow-xl z-[1000] overflow-hidden flex flex-col" style="top: calc(var(--spacing-header) + var(--spacing-tab-bar) + 8px); right: 16px; width: min(300px, calc(100vw - 32px)); max-height: calc(100vh - var(--spacing-header) - var(--spacing-tab-bar) - 24px);">
        <div class="px-5 py-3 border-b border-border bg-bg-secondary flex items-center gap-3">
          <div class="flex items-center gap-2">
            <%= lucide_icon("star", css_class: "w-4 h-4 text-blue-500 fill-blue-500") %>
            <span class="text-sm font-bold text-text-primary shrink-0">즐겨찾기 사이트맵</span>
          </div>
          <select class="w-52 bg-bg-primary border border-border text-text-primary rounded p-1.5 outline-none text-[13px]" data-header-favorites-target="groupSelect" data-action="change->header-favorites#renderMenus">
            <option value="">그룹 선택</option>
          </select>
        </div>
        <div class="flex-1 min-h-0 overflow-y-auto p-5 text-sm text-text-primary" data-header-favorites-target="menuList">
          <!-- Menus will be rendered here -->
        </div>
      </div>
    </div>

    <button class="inline-flex items-center justify-center bg-transparent border border-border rounded-md px-2 py-1.5 cursor-pointer text-text-secondary leading-none hover:bg-bg-hover transition-colors duration-150" type="button" aria-label="알림">
      <%= lucide_icon("bell", css_class: "w-4 h-4") %>
    </button>
    <button class="inline-flex items-center justify-center bg-transparent border border-border rounded-md px-2 py-1.5 cursor-pointer text-text-secondary leading-none hover:bg-bg-hover transition-colors duration-150" type="button" aria-label="설정">
      <%= lucide_icon("settings", css_class: "w-4 h-4") %>
    </button>
    <%= button_to session_path, method: :delete, class: "inline-flex items-center justify-center bg-transparent border border-border rounded-md px-2 py-1.5 cursor-pointer text-text-secondary leading-none hover:bg-bg-hover transition-colors duration-150", form: { style: "display: contents" } do %>
      <%= lucide_icon("log-out", css_class: "w-4 h-4") %>
    <% end %>
  </div>
</header>
