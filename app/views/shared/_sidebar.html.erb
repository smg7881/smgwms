<aside class="sidebar bg-bg-secondary border-r border-border flex flex-col h-screen overflow-y-auto overflow-x-hidden transition-[width] duration-250 ease-in-out" data-controller="sidebar">
  <%= link_to root_path, class: "flex items-center gap-2.5 p-4 border-b border-border font-bold text-base text-text-primary hover:bg-bg-tertiary transition-colors no-underline", data: { turbo: false } do %>
    <div class="w-8 h-8 bg-accent text-white rounded-md flex items-center justify-center font-black text-lg shrink-0">W</div>
    <span>WMS Pro</span>
  <% end %>

  <nav class="flex-1 py-2 overflow-y-auto">
    <% if dynamic_sidebar_available? %>
      <% grouped = AdmMenu.sidebar_tree %>
      <% (grouped[nil] || []).each do |menu| %>
        <% if menu.menu_type == "FOLDER" %>
          <%= render_sidebar_folder_tree(menu, grouped) %>
        <% else %>
          <%= sidebar_menu_button_from_record(menu) %>
        <% end %>
      <% end %>
    <% else %>
      <button class="nav-item has-children" type="button"
              aria-expanded="false"
              data-action="click->sidebar#toggleTree">
        <%= lucide_icon("folder", css_class: "icon") %> 메인
        <%= lucide_icon("chevron-right", css_class: "chevron") %>
      </button>
      <div class="nav-tree-children">
        <%= sidebar_menu_button "개요", tab_id: "overview", icon: "bar-chart-3", url: "/" %>
      </div>

      <% if admin? %>
        <button class="nav-item has-children expanded" type="button"
                aria-expanded="true"
                data-action="click->sidebar#toggleTree">
          <%= lucide_icon("settings", css_class: "icon") %> 시스템
          <%= lucide_icon("chevron-right", css_class: "chevron") %>
        </button>
        <div class="nav-tree-children open">
          <%= sidebar_menu_button "메뉴관리", tab_id: "system-menus", icon: "settings", url: "/system/menus" %>
          <%= sidebar_menu_button "부서관리", tab_id: "system-dept", icon: "building-2", url: "/system/dept" %>
          <%= sidebar_menu_button "사용자관리", tab_id: "system-users", icon: "user", url: "/system/users" %>
          <%= sidebar_menu_button "공통코드관리", tab_id: "system-code", icon: "binary", url: "/system/code" %>
        </div>
      <% end %>
    <% end %>
  </nav>

  <div class="flex items-center gap-2.5 px-4 py-3 border-t border-border bg-bg-secondary">
    <div class="w-8 h-8 bg-bg-tertiary border border-border rounded-full flex items-center justify-center text-xs font-bold text-accent shrink-0">WM</div>
    <div class="overflow-hidden">
      <div class="text-[13px] font-semibold text-text-primary">관리자</div>
      <div class="text-[11px] text-text-muted whitespace-nowrap overflow-hidden text-ellipsis"><%= Current.user&.email_address %></div>
    </div>
    <%= button_to session_path, method: :delete, class: "btn btn-sm btn-secondary" do %>
      로그아웃
    <% end %>
  </div>
</aside>
