<%= turbo_frame_tag "main-content" do %>
  <div data-controller="user-crud"
       data-user-crud-create-url-value="<%= system_users_path %>"
       data-user-crud-update-url-value="<%= system_user_path(':id') %>"
       data-user-crud-delete-url-value="<%= system_user_path(':id') %>"
       data-user-crud-check-id-url-value="<%= check_id_system_users_path %>">
    <%= search_form_tag(
      url: system_users_path,
      fields: [
        { field: "dept_nm", type: "input", label: "부서명", placeholder: "부서명 검색..." },
        { field: "user_nm", type: "input", label: "사원명", placeholder: "사원명 검색..." },
        { field: "work_status", type: "select", label: "재직상태",
          options: [
            { label: "전체", value: "" },
            { label: "재직", value: "ACTIVE" },
            { label: "퇴사", value: "RESIGNED" }
          ],
          include_blank: false
        }
      ],
      cols: 3,
      enable_collapse: true
    ) %>

    <div class="grid-toolbar">
      <div class="grid-toolbar-buttons">
        <button type="button" class="btn btn-sm btn-primary"
                data-action="click->user-crud#openAdd">
          신규사용자추가
        </button>
      </div>
    </div>

    <%= ag_grid_tag(
      columns: [
        { field: "user_id_code", headerName: "사번", minWidth: 120 },
        { field: "user_nm", headerName: "사원명", minWidth: 120 },
        { field: "dept_nm", headerName: "부서", minWidth: 150 },
        { field: "phone", headerName: "연락처", minWidth: 130 },
        { field: "work_status", headerName: "재직상태", maxWidth: 100, cellRenderer: "workStatusCellRenderer" },
        { field: "hire_date", headerName: "입사일", minWidth: 120, formatter: "date" },
        { field: "resign_date", headerName: "퇴사일", minWidth: 120, formatter: "date" },
        { field: "email_address", headerName: "이메일", minWidth: 200 },
        { field: "address", headerName: "주소", minWidth: 200 },
        { field: "actions", headerName: "작업", minWidth: 120, maxWidth: 120, filter: false, sortable: false, cellClass: "ag-cell-actions", cellRenderer: "userActionCellRenderer" }
      ],
      url: system_users_path(format: :json),
      height: "calc(100vh - 370px)",
      page_size: 20
    ) %>

    <%= render "system/users/form_modal" %>
  </div>
<% end %>