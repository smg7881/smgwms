<!DOCTYPE html>
<html lang="ko" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SmgWms</title>
  <link rel="icon" href="/icon.svg" type="image/svg+xml">
  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>
  <%= stylesheet_link_tag "https://cdn.jsdelivr.net/npm/trix@2.1.15/dist/trix.css", "data-turbo-track": "reload", preload_links_header: false %>
  <%= stylesheet_link_tag "https://cdn.jsdelivr.net/npm/tom-select@2.4.3/dist/css/tom-select.min.css", preload_links_header: false %>
  <%= stylesheet_link_tag "https://cdn.jsdelivr.net/npm/flatpickr@4.6.13/dist/flatpickr.min.css", preload_links_header: false %>
  <%= stylesheet_link_tag "https://cdn.jsdelivr.net/npm/daisyui@5/dist/full.min.css", preload_links_header: false %>
  <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload", preload_links_header: false %>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr@4.6.13/dist/flatpickr.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/tom-select@2.4.3/dist/js/tom-select.complete.min.js"></script>
  <%= javascript_importmap_tags %>
</head>
<body class="font-sans bg-bg-primary text-text-primary text-sm leading-normal h-screen overflow-hidden" data-controller="lucide">
  <%# data-controller="tabs" 는 반드시 app-layout 최상위에 (Stimulus 스코프: 탭바/사이드바 모두 접근 가능) %>
  <div class="grid grid-cols-[var(--spacing-sidebar)_1fr] h-screen overflow-hidden transition-[grid-template-columns] duration-250 ease-in-out"
       data-controller="tabs">

    <%= render "shared/sidebar" %>

    <main class="flex flex-col h-screen overflow-hidden">
      <%= render "shared/header" %>

      <turbo-frame id="tab-bar" class="block bg-bg-secondary border-b border-border shrink-0 min-h-[var(--spacing-tab-bar)]">
        <%= render "shared/tab_bar",
              tabs: session[:open_tabs] || [],
              active: session[:active_tab] || "overview" %>
      </turbo-frame>

      <div class="flex-1 overflow-y-auto p-4 bg-bg-primary">
        <%= yield %>
      </div>
    </main>
  </div>
</body>
</html>
